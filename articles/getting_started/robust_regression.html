<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantile/Robust regression • compboost</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Quantile/Robust regression">
<meta property="og:description" content="compboost">
<meta property="og:image" content="https://schalkdaniel.github.io/compboost/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">compboost</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Getting Started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting_started/about_cboosting.html">About Component-Wise Boosting</a>
    </li>
    <li>
      <a href="../../articles/getting_started/use_case.html">First Use-Case</a>
    </li>
    <li>
      <a href="../../articles/getting_started/early_stopping.html">Early Stopping</a>
    </li>
    <li>
      <a href="../../articles/getting_started/robust_regression.html">Quantile Regression</a>
    </li>
    <li>
      <a href="../../articles/getting_started/object_references.html">Reference Based Objects of Compboost</a>
    </li>
    <li>
      <a href="../../articles/getting_started/visualizations.html">Visualizing Compboost</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/advanced/log_performance.html">Logging Performance Measures</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Functionality
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/functionality/baselearner.html">Base-Learner</a>
    </li>
    <li>
      <a href="../../articles/functionality/loss.html">Loss Functions</a>
    </li>
    <li>
      <a href="../../articles/functionality/logger.html">Logger</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/schalkdaniel/compboost">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="robust_regression_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quantile/Robust regression</h1>
            
      
      
      <div class="hidden name"><code>robust_regression.Rmd</code></div>

    </div>

    
    
<div id="how-does-it-work" class="section level2">
<h2 class="hasAnchor">
<a href="#how-does-it-work" class="anchor"></a>How does it work?</h2>
<p>Boosting quantiles is just controlled by the loss function. Quantile regression was originally motivated for general additive/linear models (<a href="https://en.wikipedia.org/wiki/Quantile_regression">see here</a>). We can use that theory to define the following loss function:</p>
<p><span class="math display">\[
L(y, f(x)) = h|y - f(x)|
\]</span> with <span class="math display">\[
h = \left\{
\begin{array}{ccc}
2q       &amp; \ \ \text{if} \ \ &amp; y - f(x) &gt; 0 \\
2(1 - q) &amp; \ \ \text{if} \ \ &amp; \text{otherwise}
\end{array}
\right.
\]</span> where <span class="math inline">\(q\)</span> corresponds to the quantile we like to boost. Visualizing the loss, depending on the residuals <span class="math inline">\(y - f(x)\)</span>, shows that, for example, boosting the 90 % quantile punishes residuals greater than zero much more than residuals smaller than zeros which leads to an optimization of the 90 % quantile:</p>
<p><img src="robust_regression_files/figure-html/unnamed-chunk-2-1.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div id="simulate-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-data" class="anchor"></a>Simulate data</h2>
<p>To show the effect of quantile/robust regression we simulate data that follows a sinus curve with 20 outliers:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nsim</span> <span class="op">=</span> <span class="fl">1000</span>
<span class="va">noutlier</span> <span class="op">=</span> <span class="fl">20</span>
<span class="va">outlier_mean</span> <span class="op">=</span> <span class="fl">1e6</span>

<span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">nsim</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">y</span> <span class="op">=</span> <span class="fl">3</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">nsim</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>

<span class="va">outlier_idx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">nsim</span>, <span class="va">noutlier</span><span class="op">)</span>
<span class="va">y</span><span class="op">[</span><span class="va">outlier_idx</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">noutlier</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">noutlier</span>, <span class="va">outlier_mean</span>, <span class="fl">1</span><span class="op">)</span>

<span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Warning: Removed 20 rows containing missing values (geom_point).</code></pre>
<p><img src="robust_regression_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="how-to-use-in-compboost" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-use-in-compboost" class="anchor"></a>How to use in compboost</h2>
<div id="boosting-the-median" class="section level3">
<h3 class="hasAnchor">
<a href="#boosting-the-median" class="anchor"></a>Boosting the median</h3>
<p>All you need to do is to use the <code>LossQuantile</code> class generator. For example, to boost the median (50 % quantile) pass <code>0.5</code> to the constructor:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loss_quantile50</span> <span class="op">=</span> <span class="va"><a href="../../reference/LossQuantile.html">LossQuantile</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>
<span class="va">loss_quantile50</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; LossQuantile Loss:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Loss function: L(y,x) = h|y - f(x)|</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   h = 2q        if  y - f(x) &gt; 0</span>
<span class="co">#&gt;   h = 2(1 - q)  otherwise</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   with quantile q = 0.5</span></code></pre></div>
<p>A little side note: Boosting the median or the 50 % quantile is equivalent to conduct boosting with the absolute loss.</p>
<p>The <code>loss_quantile90</code> loss object can now be used to define and train a new <code>Compboost</code> object:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cboost_quantile50</span> <span class="op">=</span> <span class="fu"><a href="../../reference/boostSplines.html">boostSplines</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, target <span class="op">=</span> <span class="st">"y"</span>, loss <span class="op">=</span> <span class="va">loss_quantile50</span>, iterations <span class="op">=</span> <span class="fl">1000L</span>, trace <span class="op">=</span> <span class="fl">200L</span><span class="op">)</span>
<span class="co">#&gt;    1/1000   risk = 2e+04  time = 0   </span>
<span class="co">#&gt;  200/1000   risk = 2e+04  time = 15983   </span>
<span class="co">#&gt;  400/1000   risk = 2e+04  time = 35213   </span>
<span class="co">#&gt;  600/1000   risk = 2e+04  time = 54346   </span>
<span class="co">#&gt;  800/1000   risk = 2e+04  time = 74901   </span>
<span class="co">#&gt; 1000/1000   risk = 2e+04  time = 100130   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Train 1000 iterations in 0 Seconds.</span>
<span class="co">#&gt; Final risk based on the train set: 2e+04</span></code></pre></div>
<p>Using the absolute loss to boost the median is also known as robust regression since outliers do not get as much weight as using the quadratic loss. To visualize the effect of outliers on the regression we do also train a model using the <code>QuadraticLoss</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cboost_mean</span> <span class="op">=</span> <span class="fu"><a href="../../reference/boostSplines.html">boostSplines</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, target <span class="op">=</span> <span class="st">"y"</span>, loss <span class="op">=</span> <span class="va"><a href="../../reference/LossQuadratic.html">LossQuadratic</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>, iterations <span class="op">=</span> <span class="fl">1000L</span>, trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Train 1000 iterations in 0 Seconds.</span>
<span class="co">#&gt; Final risk based on the train set: 9.7e+09</span>

<span class="va">df_plot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">x</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
  preds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cboost_mean</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span>, <span class="va">cboost_quantile50</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
  estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">gg1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feature</span>, y <span class="op">=</span> <span class="va">preds</span>, color <span class="op">=</span> <span class="va">estimator</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Full target range (with outliers)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggthemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_tufte.html">theme_tufte</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">gg2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feature</span>, y <span class="op">=</span> <span class="va">preds</span>, color <span class="op">=</span> <span class="va">estimator</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Real target range (without outliers)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggthemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_tufte.html">theme_tufte</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">gg1</span>, <span class="va">gg2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 20 rows containing missing values (geom_point).</span>
<span class="co">#&gt; Warning: Removed 1000 row(s) containing missing values (geom_path).</span></code></pre></div>
<p><img src="robust_regression_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>It is clear to see that boosting with the quadratic loss is quite sensitive against outliers. Of course, this example is very exaggerated to show the effect of boosting the median.</p>
</div>
<div id="boosting-arbitrary-quantiles" class="section level3">
<h3 class="hasAnchor">
<a href="#boosting-arbitrary-quantiles" class="anchor"></a>Boosting arbitrary quantiles</h3>
<p>Instead of boosting the median we can boost every quantile we like. In this example we are additionally boosting the 10 % and 90 % quantile to get “some kind of confidence interval”. Be careful with using the term confidence interval here since all predictions are estimated independent from each other which may tighten the boundaries:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cboost</span> <span class="op">=</span> <span class="fu"><a href="../../reference/boostSplines.html">boostSplines</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, target <span class="op">=</span> <span class="st">"y"</span>, loss <span class="op">=</span> <span class="va"><a href="../../reference/LossQuadratic.html">LossQuadratic</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>, iterations <span class="op">=</span> <span class="fl">1000</span>, trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Train 1000 iterations in 0 Seconds.</span>
<span class="co">#&gt; Final risk based on the train set: 9.7e+09</span>
<span class="va">cboost_10</span> <span class="op">=</span> <span class="fu"><a href="../../reference/boostSplines.html">boostSplines</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, target <span class="op">=</span> <span class="st">"y"</span>, loss <span class="op">=</span> <span class="va"><a href="../../reference/LossQuantile.html">LossQuantile</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, iterations <span class="op">=</span> <span class="fl">1000</span>, trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Train 1000 iterations in 0 Seconds.</span>
<span class="co">#&gt; Final risk based on the train set: 2.8e+04</span>
<span class="va">cboost_50</span> <span class="op">=</span> <span class="fu"><a href="../../reference/boostSplines.html">boostSplines</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, target <span class="op">=</span> <span class="st">"y"</span>, loss <span class="op">=</span> <span class="va"><a href="../../reference/LossQuantile.html">LossQuantile</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, iterations <span class="op">=</span> <span class="fl">1000</span>, trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Train 1000 iterations in 0 Seconds.</span>
<span class="co">#&gt; Final risk based on the train set: 2e+04</span>
<span class="va">cboost_90</span> <span class="op">=</span> <span class="fu"><a href="../../reference/boostSplines.html">boostSplines</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, target <span class="op">=</span> <span class="st">"y"</span>, loss <span class="op">=</span> <span class="va"><a href="../../reference/LossQuantile.html">LossQuantile</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">0.9</span><span class="op">)</span>, iterations <span class="op">=</span> <span class="fl">1000</span>, trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; Train 1000 iterations in 0 Seconds.</span>
<span class="co">#&gt; Final risk based on the train set: 1.2e+04</span>

<span class="va">df_pred</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  feat <span class="op">=</span> <span class="va">x</span>,
  target <span class="op">=</span> <span class="va">y</span>,
  mean <span class="op">=</span> <span class="va">cboost</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span>,
  quantile_10 <span class="op">=</span> <span class="va">cboost_10</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span>,
  quantile_50 <span class="op">=</span> <span class="va">cboost_50</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span>,
  quantile_90 <span class="op">=</span> <span class="va">cboost_90</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">df_pred</span> <span class="op">=</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_pred</span>, key <span class="op">=</span> <span class="st">"estimator"</span>, value <span class="op">=</span> <span class="st">"pred"</span>, <span class="va">mean</span><span class="op">:</span><span class="va">quantile_90</span><span class="op">)</span>

<span class="va">gg1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feat</span>, y <span class="op">=</span> <span class="va">target</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feat</span>, y <span class="op">=</span> <span class="va">pred</span>, color <span class="op">=</span> <span class="va">estimator</span>, linetype <span class="op">=</span> <span class="va">estimator</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Feature"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Target"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggthemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_tufte.html">theme_tufte</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Full target range (with outliers)"</span><span class="op">)</span>

<span class="va">gg2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feat</span>, y <span class="op">=</span> <span class="va">target</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feat</span>, y <span class="op">=</span> <span class="va">pred</span>, color <span class="op">=</span> <span class="va">estimator</span>, linetype <span class="op">=</span> <span class="va">estimator</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Feature"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggthemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_tufte.html">theme_tufte</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Real target range (without outliers)"</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">gg1</span>, <span class="va">gg2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 80 rows containing missing values (geom_point).</span>
<span class="co">#&gt; Warning: Removed 1000 row(s) containing missing values (geom_path).</span></code></pre></div>
<p><img src="robust_regression_files/figure-html/unnamed-chunk-8-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="comments" class="section level2">
<h2 class="hasAnchor">
<a href="#comments" class="anchor"></a>Comments</h2>
<p>Boosting the median is a technique to get a more robust model. Nevertheless, since boosting the mean has some nice estimation properties we introduce more variance in the estimators if we use the quantile loss. To get as precise predictions we need much more data to reduce the variance. Another better loss in terms of variance is the Huber loss <code>LossHuber$new()</code> which uses a quadratic approximation at around zero and after a threshold <span class="math inline">\(\delta\)</span> a linear extrapolation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Schalk, Janek Thomas, Bernd Bischl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
